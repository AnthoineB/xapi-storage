<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundation | Welcome</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>

    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  </head>
  <body>

<nav class="top-bar" data-topbar="" role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="index.html">Xapi storage interface</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>
  <section class="top-bar-section">
    <ul class="right">
      <li class="has-dropdown">
        <a href="learn.html">Learn</a>
        <ul class="dropdown">
          <li><a href="features.html">Features</a></li>
          <li><a href="faq.html">FAQ</a></li>
        </ul>
      </li>
      <li class="has-dropdown">
        <a href="#">Develop</a>
        <ul class="dropdown">
          <li><a href="concepts.html">Concepts</a></li>
          
      <li><a href="control.html">control</a></li>
    
      <li><a href="data.html">data</a></li>
    
        </ul>
      </li>
      <li class="has-dropdown">
        <a href="#">Support</a>
        <ul class="dropdown">
          <li><a href="contact.html">Mailing list</a></li>
          <li><a href="contact.html">Issue tracker</a></li>
          <li><a href="contact.html">IRC</a></li>
        </ul>
      </li>
      <li class="active"><a href="getstarted.html">Get Started</a></li>
    </ul>
  </section>
</nav>

    <div class="row">

    
      <div class="large-3 medium-3 columns">
        <ul class="side-nav">
          <li><label>types</label></li>
          
      <li><a href="#a-10">debug_info</a></li>
    
      <li><a href="#a-11">reservation_id</a></li>
    
          <li class="divider"/>
          <li><label>interfaces</label></li>
          
      <li><label>Memory</label></li>
      
      <li><a href="#a-12">info</a></li>
    
      
      <li><a href="#a-reserve">reserve</a></li>
    
    
          <li class="divider"/>
          <li><a href="#a-exceptions">exceptions</a></li>
        </ul>
      </div>
  

    <div class="large-9 medium-9 columns">
      <h1>data</h1>
      <p>The memory management service (also known as &quot;squeezed&quot;) shares host memory among running VMs via their balloon drivers. Each VM has an associated memory range (minimum and maximum amount of allocated memory) and the manager attempts to share the host memory fairly.</p>
      
    <h4 id="a-10">type debug_info = string</h4>
    <p> Debug context from the caller </p>
  
    <h4 id="a-11">type reservation_id = string</h4>
    <p> A reference (or handle) to a memory reservation </p>
  
      
    <h2 id="a-Memory">Memory</h2>
    <p>Create and manipulate VM memory reservations</p>
    
    <h4 id="a-12">type info = struct  { ... }</h4>
    <p> Properties of this service </p>
  
      <p>Members:</p>
    
    <table width="100%">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
      
      <tr>
        <td><pre>name</pre></td>
        <td><pre>string</pre></td>
        <td>Human-readable name of this service</td></tr>
    
      <tr>
        <td><pre>vendor</pre></td>
        <td><pre>string</pre></td>
        <td>Vendor of this service</td></tr>
    
      <tr>
        <td><pre>version</pre></td>
        <td><pre>string</pre></td>
        <td>Version number of this service</td></tr>
    
      <tr>
        <td><pre>features</pre></td>
        <td><pre>string list</pre></td>
        <td>A set of feature flags</td></tr>
    
      <tr>
        <td><pre>instance_id</pre></td>
        <td><pre>string</pre></td>
        <td>A unique id for this instance, regenerated over service restart</td></tr>
    
      </tbody>
    </table>
  
    
    <h3 id="a-reserve">reserve</h3>
    <p>[reserve kib] reserves [kib] of memory for some undisclosed purpose and returns a reservation id</p>
    
    <dl class="tabs" data-tab="">
      <dd class="active"><a href="#defn-reserve">Definition</a></dd>
     <dd><a href="#ocaml-reserve">OCaml example</a></dd>
     <dd><a href="#python-reserve">Python example</a></dd>
    </dl>
    <div class="tabs-content">
      <div class="content active" id="defn-reserve">
        
  <table width="100%">
  <thead>
    <tr>
      <th>Name</th>
      <th>Direction</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td><code>dbg</code></td>
      <td>in</td>
      <td><code> <a href="#a-10">debug_info</a> </code></td>
      <td>Debug context from the caller</td>
    </tr>
  
    <tr>
      <td><code>reservation_id</code></td>
      <td>out</td>
      <td><code> <a href="#a-11">reservation_id</a> </code></td>
      <td>A reference to a reservation which can be transferred to a VM</td>
    </tr>
  
  </tbody>
  </table>
  
      </div>
      <div class="content" id="ocaml-reserve">
        <h4>Client</h4>
        
<pre>
<span style="color:#990000">(* these directives only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt.syntax&quot;</span>;;
#require <span style="color:#aa4444">&quot;rpc.unix&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Data</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>

<span style="color:green">module</span> <span style="color:#0033cc">Client</span> = <span style="color:#0033cc">Memory_client</span>(<span style="color:#990099">struct</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Lwt</span>
    <span style="color:green">let</span> rpc call = return (<span style="color:#0033cc">Rpc_client</span>.do_rpc ~content_type:<span style="color:#0033cc">`</span><span style="color:#0033cc">XML</span> ~path:<span style="color:#aa4444">&quot;/&quot;</span> ~host:<span style="color:#aa4444">&quot;127.0.0.1&quot;</span> ~port:80 call) <span style="color:#990000">(* TODO: Rpc_client needs to support Lwt *)</span>
<span style="color:#990099">end</span>)

<span style="color:green">let</span> result = <span style="color:#0033cc">Client</span>.reserve ~dbg:<span style="color:#aa4444">&quot;string&quot;</span>;;</pre>


        <h4>Server</h4>
        
<pre>
<span style="color:#990000">(* this line only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Data</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>

<span style="color:green">module</span> <span style="color:#0033cc">Memory_myimplementation</span> = <span style="color:green">functor</span>(<span style="color:#0033cc">M</span>: <span style="color:#0033cc">M</span>) -&gt; <span style="color:#990099">struct</span>
    <span style="color:#990000">(* by default every operation will return a 'not implemented' exception *)</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Memory_skeleton</span>(<span style="color:#0033cc">M</span>)
    <span style="color:#990000">(* ... *)</span>
    <span style="color:green">let</span> reserve x =
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Memory</span>.<span style="color:#0033cc">Reserve</span> <span style="color:green">in</span>
        return (<span style="color:#0033cc">`</span><span style="color:#0033cc">Ok</span> (<span style="color:#0033cc">Out</span>.(<span style="color:#aa4444">&quot;string&quot;</span>)))
    <span style="color:#990000">(* ... *)</span>
<span style="color:#990099">end</span></pre>


      </div>
      <div class="content" id="python-reserve">
        <h4>Client</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xcp
from storage import *

if __name__ == &quot;__main__&quot;:
    c = xcp.connect()
    results = c.Memory.reserve({ dbg: &quot;string&quot; })
    print (repr(results))
        </pre>
        <h4>Server</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xcp
from storage import *

class Memory_myimplementation(Memory_skeleton):
    # by default each method will return a Not_implemented error
    # ...
    def reserve(self, dbg):
        &quot;&quot;&quot;Create and manipulate VM memory reservations&quot;&quot;&quot;
        result = {}
        result[&quot;reservation_id&quot;] = &quot;string&quot;
        return result
    # ...
        </pre>
      </div>
    </div>
  
  
  
      of_exception env x.Interfaces.exn_decls)$
    </div>
    </div>
  
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>
